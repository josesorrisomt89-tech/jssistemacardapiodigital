<style>
  @media print {
    body * {
      visibility: hidden;
    }
    .printable-guide, .printable-guide * {
      visibility: visible;
    }
    .printable-guide {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: auto;
      margin: 0;
      padding: 20px;
      border: none;
      color: #000 !important;
      background-color: #fff !important;
    }
    .printable-guide .bg-gray-800, 
    .printable-guide .bg-gray-700,
    .printable-guide .bg-gray-900 {
        background-color: #f3f4f6 !important;
        border-color: #d1d5db !important;
    }
    .printable-guide .text-purple-400,
    .printable-guide .text-yellow-400,
    .printable-guide .text-red-500,
    .printable-guide .text-gray-300 {
        color: #000 !important;
    }
    .printable-guide a {
        text-decoration: none !important;
        color: #1d4ed8 !important;
    }
    .printable-guide code {
        background-color: #e5e7eb;
        padding: 2px 4px;
        border-radius: 4px;
        font-family: monospace;
        color: #111827 !important;
    }
    .no-print {
      display: none !important;
    }
  }
</style>

<div class="min-h-screen bg-gray-800 text-white p-4 sm:p-6 lg:p-8">
  <audio #newOrderSound src="https://cdn.jsdelivr.net/gh/red-full-moon/Google-Action-Sounds@master/notifications/bell.ogg" loop></audio>
  
  @if (isNewOrderNotificationActive()) {
    <div class="fixed top-4 left-1/2 -translate-x-1/2 z-[100] bg-green-500 text-white text-center font-bold p-3 rounded-lg shadow-lg animate-pulse no-print">
      <p>üîî NOVO PEDIDO RECEBIDO! üîî</p>
      <p class="text-xs font-normal">Altere o status do pedido para silenciar o alarme.</p>
    </div>
  }

  @if (!isLoggedIn()) {
    <div class="max-w-md mx-auto bg-gray-900 p-8 rounded-lg shadow-lg mt-20">
      <h1 class="text-2xl font-bold text-center mb-6 text-purple-400">Acesso Restrito</h1>
      <form [formGroup]="loginForm" (ngSubmit)="handleLogin()" class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Usu√°rio</label>
          <input type="text" id="username" formControlName="username" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 focus:ring-purple-500 focus:border-purple-500">
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Senha</label>
          <input type="password" id="password" formControlName="password" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 focus:ring-purple-500 focus:border-purple-500">
        </div>
        @if (loginError()) {
          <p class="text-red-500 text-sm text-center">{{ loginError() }}</p>
        }
        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg">Entrar</button>
      </form>
      <div class="text-center mt-6">
        <a routerLink="/" class="text-sm text-gray-400 hover:text-white transition-colors flex items-center justify-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
          Sair e voltar ao in√≠cio
        </a>
      </div>
    </div>
  } @else {
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-6 no-print">
        <h1 class="text-3xl font-bold text-purple-400">Painel Administrativo</h1>
        <button (click)="logout()" class="text-sm text-gray-400 hover:text-white">Sair</button>
      </div>

      <!-- Tabs -->
      <div class="border-b border-gray-700 mb-6 overflow-x-auto scrollbar-hide no-print">
        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
          <button (click)="activeTab.set('orders')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap relative" [class.border-purple-500]="activeTab() === 'orders'" [class.text-purple-400]="activeTab() === 'orders'" [class.border-transparent]="activeTab() !== 'orders'" [class.text-gray-400]="activeTab() !== 'orders'">
            Pedidos Ativos
             @if (isNewOrderNotificationActive()) {
              <span class="absolute top-2 -right-3 flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
              </span>
            }
          </button>
          <button (click)="activeTab.set('pdv')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'pdv'" [class.text-purple-400]="activeTab() === 'pdv'" [class.border-transparent]="activeTab() !== 'pdv'" [class.text-gray-400]="activeTab() !== 'pdv'">PDV</button>
          <button (click)="activeTab.set('sales')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'sales'" [class.text-purple-400]="activeTab() === 'sales'" [class.border-transparent]="activeTab() !== 'sales'" [class.text-gray-400]="activeTab() !== 'sales'">Vendas</button>
          <button (click)="activeTab.set('accounts')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'accounts'" [class.text-purple-400]="activeTab() === 'accounts'" [class.border-transparent]="activeTab() !== 'accounts'" [class.text-gray-400]="activeTab() !== 'accounts'">Financeiro</button>
          <button (click)="activeTab.set('products')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'products'" [class.text-purple-400]="activeTab() === 'products'" [class.border-transparent]="activeTab() !== 'products'" [class.text-gray-400]="activeTab() !== 'products'">Produtos</button>
          <button (click)="activeTab.set('coupons')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'coupons'" [class.text-purple-400]="activeTab() === 'coupons'" [class.border-transparent]="activeTab() !== 'coupons'" [class.text-gray-400]="activeTab() !== 'coupons'">Cupons</button>
          <button (click)="activeTab.set('roleta')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'roleta'" [class.text-purple-400]="activeTab() === 'roleta'" [class.border-transparent]="activeTab() !== 'roleta'" [class.text-gray-400]="activeTab() !== 'roleta'">Roleta</button>
          <button (click)="activeTab.set('loyalty')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'loyalty'" [class.text-purple-400]="activeTab() === 'loyalty'" [class.border-transparent]="activeTab() !== 'loyalty'" [class.text-gray-400]="activeTab() !== 'loyalty'">Fidelidade</button>
          <button (click)="activeTab.set('drivers')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'drivers'" [class.text-purple-400]="activeTab() === 'drivers'" [class.border-transparent]="activeTab() !== 'drivers'" [class.text-gray-400]="activeTab() !== 'drivers'">Entregadores</button>
          <button (click)="activeTab.set('layout')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'layout'" [class.text-purple-400]="activeTab() === 'layout'" [class.border-transparent]="activeTab() !== 'layout'" [class.text-gray-400]="activeTab() !== 'layout'">Layout</button>
          <button (click)="activeTab.set('settings')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'settings'" [class.text-purple-400]="activeTab() === 'settings'" [class.border-transparent]="activeTab() !== 'settings'" [class.text-gray-400]="activeTab() !== 'settings'">Configura√ß√µes</button>
          <button (click)="activeTab.set('help')" class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap" [class.border-purple-500]="activeTab() === 'help'" [class.text-purple-400]="activeTab() === 'help'" [class.border-transparent]="activeTab() !== 'help'" [class.text-gray-400]="activeTab() !== 'help'">Ajuda</button>
        </nav>
      </div>

      <!-- Content -->
      <div>
        <!-- Tab: Pedidos -->
        <div [class.hidden]="activeTab() !== 'orders'">
          <!-- Scheduled Orders -->
          @if (scheduledOrders().length > 0) {
            <div class="mb-8 p-4 bg-gray-900 rounded-lg">
              <h2 class="text-xl font-bold mb-4 text-yellow-400">Pedidos Agendados</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for(order of scheduledOrders(); track order.id){
                  <div class="bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-yellow-400 relative">
                     <div class="flex justify-between items-start mb-2">
                        <div>
                          <h3 class="font-bold text-lg">#{{ order.id.slice(-4) }}</h3>
                          <span class="text-sm font-semibold bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded">Agendado para {{order.scheduled_time}}</span>
                        </div>
                        <button (click)="openReceiptModal(order, 'print')" class="text-gray-400 hover:text-white" title="Imprimir cupom">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v3h6v-3z" clip-rule="evenodd" /></svg>
                        </button>
                      </div>
                      <p class="text-sm">{{ order.customer_name }}</p>
                      <p class="text-xs text-gray-400">{{ order.delivery_option === 'delivery' ? order.delivery_address + ', ' + order.neighborhood : 'Retirada na loja' }}</p>
                      <p class="text-lg font-bold my-2">{{ order.total | currency:'BRL' }}</p>
                      <div class="flex items-center space-x-2">
                        <label class="text-sm">Status:</label>
                        <select (change)="updateOrderStatus(order.id, $event)" class="bg-gray-700 rounded p-1 text-sm flex-grow">
                          @for(status of orderStatuses; track status){
                            <option [value]="status" [selected]="order.status === status">{{ status }}</option>
                          }
                        </select>
                      </div>
                  </div>
                }
              </div>
            </div>
          }
          <!-- Kanban Board -->
          <div class="flex flex-col lg:flex-row gap-4 overflow-x-auto pb-4">
            @for(column of kanbanColumns; track column.title) {
              <div class="lg:w-1/5 flex-shrink-0 min-w-[300px]">
                <h2 class="text-xl font-bold mb-4">{{ column.title }} ({{ column.orders().length }})</h2>
                <div class="space-y-4 h-[60vh] overflow-y-auto pr-2">
                    @for(order of column.orders(); track order.id) {
                      <div class="bg-gray-900 p-4 rounded-lg shadow-md">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-bold text-lg">#{{ order.id.slice(-4) }}</h3>
                                <p class="text-sm">{{ order.customer_name }}</p>
                                <p class="text-xs text-gray-400">{{ order.delivery_option === 'delivery' ? 'Delivery' : 'Retirada' }}</p>
                            </div>
                           <button (click)="openReceiptModal(order, 'print')" class="text-gray-400 hover:text-white" title="Imprimir cupom">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v3h6v-3z" clip-rule="evenodd" /></svg>
                           </button>
                        </div>

                         <div class="text-xs space-y-1 mb-3">
                          @for(item of order.items; track $index) {
                            <p>{{ item.quantity }}x {{ item.product_name }} ({{item.size.name}})</p>
                            @if (item.notes) {
                                <p class="text-yellow-300 italic pl-2">Obs: {{ item.notes }}</p>
                            }
                          }
                        </div>

                        <p class="text-lg font-bold my-2">{{ order.total | currency:'BRL' }}</p>
                        
                        <div class="flex items-center space-x-2 mb-2">
                            <label class="text-sm">Status:</label>
                            <select (change)="updateOrderStatus(order.id, $event)" class="bg-gray-700 rounded p-1 text-sm flex-grow">
                                @for(status of orderStatuses; track status){
                                    <option [value]="status" [selected]="order.status === status">{{ status }}</option>
                                }
                            </select>
                        </div>
                        @if(order.delivery_option === 'delivery') {
                          <div class="text-sm">
                            @if(order.assigned_driver_name) {
                              <div class="flex items-center justify-between bg-green-500/20 text-green-300 p-2 rounded">
                                <span>üõµ {{ order.assigned_driver_name }}</span>
                                <button (click)="cancelDelivery(order.id)" class="text-xs text-red-400 hover:text-red-300" title="Cancelar entrega">x</button>
                              </div>
                            } @else {
                              <div class="grid grid-cols-2 gap-2">
                                <button (click)="openReceiptModal(order, 'delivery')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-3 rounded text-xs">
                                  Enviar WhatsApp Entregador Proprio
                                </button>
                                 <button (click)="openDriverAssignmentModal(order)" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-3 rounded text-xs">
                                  Enviar Entregador App
                                </button>
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Tab: PDV -->
        <div [class.hidden]="activeTab() !== 'pdv'">
           @if (pdvState() === 'selecting') {
             <div class="flex flex-col items-center justify-center h-96">
                <h2 class="text-2xl font-bold mb-6">Selecione o tipo de venda</h2>
                <div class="flex gap-8">
                    <button (click)="startPdvOrder('balcao')" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-6 px-12 rounded-lg text-xl">
                        Venda Balc√£o
                    </button>
                    <button (click)="startPdvOrder('delivery')" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-6 px-12 rounded-lg text-xl">
                        Delivery
                    </button>
                </div>
            </div>
           } @else {
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Product Selection -->
                <div class="bg-gray-900 rounded-lg p-4 h-[75vh] flex flex-col">
                  <h3 class="text-xl font-bold mb-4">Produtos</h3>
                   <div class="overflow-y-auto space-y-2">
                    @for(category of sortedCategories(); track category.id) {
                       <div class="mb-4">
                          <h4 class="font-bold text-purple-400 mb-2">{{ category.name }}</h4>
                          <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                            @for(product of sortedProducts(); track product.id) {
                                @if(product.category_id === category.id) {
                                   <button (click)="openPdvProductModal(product)" [disabled]="!product.is_available" class="p-2 rounded-lg text-left h-24 flex flex-col justify-between disabled:opacity-50 disabled:cursor-not-allowed" [style.backgroundColor]="product.is_available ? '#2d3748' : '#4a5568'">
                                        <span class="text-sm font-semibold">{{ product.name }}</span>
                                        <span class="text-xs font-bold text-green-400">
                                            @if (product.price_type === 'fixed') { {{ product.price | currency:'BRL' }} }
                                            @else { A partir de {{ (product.sizes.length > 0 ? product.sizes[0].price : 0) | currency:'BRL' }} }
                                        </span>
                                    </button>
                                }
                            }
                          </div>
                       </div>
                    }
                   </div>
                </div>

                <!-- Cart & Checkout -->
                <div class="bg-gray-900 rounded-lg p-4 h-[75vh] flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Pedido Atual ({{ pdvState() === 'balcao' ? 'Balc√£o' : 'Delivery' }})</h3>
                        <button (click)="cancelPdvOrder()" class="text-sm text-red-400 hover:text-red-300">Cancelar Pedido</button>
                    </div>
                    <!-- Cart -->
                    <div class="flex-grow overflow-y-auto bg-gray-800 rounded p-2 mb-4 space-y-2">
                       @for(item of pdvCart(); track $index) {
                          <div class="bg-gray-700 p-2 rounded text-sm">
                            <div class="flex justify-between">
                                <span class="font-semibold">{{item.product_name}} ({{item.size.name}})</span>
                                <span>{{item.total_price | currency:'BRL'}}</span>
                            </div>
                            @if (item.notes) {
                                <p class="text-xs text-yellow-300 italic">Obs: {{ item.notes }}</p>
                            }
                             @if(item.addons.length > 0) {
                                <p class="text-xs text-gray-400">+ {{ getAddonNames(item.addons) }}</p>
                             }
                             <div class="flex items-center justify-between mt-1">
                                <div class="flex items-center space-x-2">
                                  <button (click)="decrementPdvCartItem($index)" class="w-5 h-5 rounded bg-gray-600">-</button>
                                  <span>{{item.quantity}}</span>
                                  <button (click)="incrementPdvCartItem($index)" class="w-5 h-5 rounded bg-gray-600">+</button>
                                </div>
                                <button (click)="removePdvCartItem($index)" class="text-xs text-red-400">Remover</button>
                             </div>
                          </div>
                       }
                        @if (pdvCart().length === 0) { <p class="text-center text-gray-500 py-4">Carrinho vazio</p> }
                    </div>
                    <!-- Checkout Form -->
                    <form [formGroup]="pdvCheckoutForm" (ngSubmit)="finalizePdvOrder()" class="space-y-3">
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <input formControlName="customer_name" placeholder="Nome do Cliente" class="w-full p-2 bg-gray-700 rounded">
                            <input formControlName="phone" placeholder="Telefone (opcional)" class="w-full p-2 bg-gray-700 rounded">
                         </div>
                         @if (pdvState() === 'delivery') {
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <input formControlName="street" placeholder="Rua" class="sm:col-span-2 w-full p-2 bg-gray-700 rounded">
                                <input formControlName="number" placeholder="N¬∫" class="w-full p-2 bg-gray-700 rounded">
                            </div>
                             <select formControlName="neighborhood" class="w-full p-2 bg-gray-700 rounded">
                                <option value="">Selecione o Bairro</option>
                                 @for(hood of dataService.settings().delivery.neighborhoods; track hood.name) {
                                    <option [value]="hood.name">{{hood.name}} - {{hood.fee | currency:'BRL'}}</option>
                                 }
                             </select>
                         }
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <select formControlName="payment_method" class="w-full p-2 bg-gray-700 rounded">
                                <option value="cash">Dinheiro</option>
                                <option value="card">Cart√£o</option>
                                <option value="pix-machine">PIX</option>
                                <option value="credit">Fiado</option>
                            </select>
                            <input type="number" formControlName="change_for" placeholder="Troco para?" class="w-full p-2 bg-gray-700 rounded">
                         </div>
                         @if (pdvCheckoutForm.get('payment_method')?.value === 'credit') {
                            <div class="grid grid-cols-2 gap-3">
                                <input formControlName="address" placeholder="Endere√ßo para cobran√ßa" class="w-full p-2 bg-gray-700 rounded">
                                <input type="date" formControlName="payment_due_date" class="w-full p-2 bg-gray-700 rounded">
                            </div>
                         }
                         <div class="border-t border-gray-700 pt-3 space-y-1 text-sm">
                            <div class="flex justify-between"><span>Subtotal:</span><span>{{pdvSubtotal() | currency:'BRL'}}</span></div>
                            <div class="flex justify-between"><span>Entrega:</span><span>{{pdvDeliveryFee() | currency:'BRL'}}</span></div>
                            <div class="flex justify-between font-bold text-lg"><span>Total:</span><span>{{pdvTotal() | currency:'BRL'}}</span></div>
                         </div>
                         <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg">Finalizar Venda</button>
                    </form>
                </div>
            </div>
           }
        </div>

        <!-- Tab: Vendas -->
        <div [class.hidden]="activeTab() !== 'sales'">
          <h2 class="text-2xl font-bold mb-4">Hist√≥rico de Vendas</h2>
          @if(salesDashboardStats(); as stats) {
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center">
                <div class="bg-gray-900 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">Faturamento Total</p>
                    <p class="text-3xl font-bold text-green-400">{{ stats.totalRevenue | currency:'BRL' }}</p>
                </div>
                <div class="bg-gray-900 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">Pedidos (N√£o Cancelados)</p>
                    <p class="text-3xl font-bold text-purple-400">{{ stats.orderCount }}</p>
                </div>
                <div class="bg-gray-900 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">Ticket M√©dio</p>
                    <p class="text-3xl font-bold text-blue-400">{{ stats.avgTicket | currency:'BRL' }}</p>
                </div>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                 <div class="bg-gray-900 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Faturamento por Pagamento</h3>
                    <div class="space-y-1 text-sm">
                       @for(item of stats.revenueByPayment | keyvalue; track item.key) {
                        <div class="flex justify-between">
                            <span>{{ paymentMethodNames[item.key] || item.key }}</span>
                            <span class="font-semibold">{{ item.value | currency:'BRL' }}</span>
                        </div>
                       }
                    </div>
                </div>
                <div class="bg-gray-900 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Faturamento por Tipo</h3>
                     <div class="space-y-1 text-sm">
                       @for(item of stats.revenueByType | keyvalue; track item.key) {
                        <div class="flex justify-between">
                            <span>{{ paymentMethodNames[item.key] || item.key }}</span>
                            <span class="font-semibold">{{ item.value | currency:'BRL' }}</span>
                        </div>
                       }
                    </div>
                </div>
            </div>
          }
          <!-- Filters -->
          <div class="bg-gray-900 p-4 rounded-lg mb-4 flex flex-wrap gap-4 items-end">
            <div class="flex-grow">
                <label class="text-xs text-gray-400">Data In√≠cio</label>
                <input type="date" class="w-full bg-gray-700 p-2 rounded text-sm" [value]="salesFilterStartDate()" (input)="salesFilterStartDate.set($any($event.target).value)">
            </div>
            <div class="flex-grow">
                <label class="text-xs text-gray-400">Data Fim</label>
                <input type="date" class="w-full bg-gray-700 p-2 rounded text-sm" [value]="salesFilterEndDate()" (input)="salesFilterEndDate.set($any($event.target).value)">
            </div>
            <div class="flex-grow">
                <label class="text-xs text-gray-400">Tipo</label>
                <select class="w-full bg-gray-700 p-2 rounded text-sm" [value]="salesFilterType()" (change)="salesFilterType.set($any($event.target).value)">
                    <option value="">Todos</option>
                    @for(type of uniqueSalesFilterOptions().types; track type) {
                        <option [value]="type">{{ paymentMethodNames[type] || type }}</option>
                    }
                </select>
            </div>
            <div class="flex-grow">
                <label class="text-xs text-gray-400">Status</label>
                <select class="w-full bg-gray-700 p-2 rounded text-sm" [value]="salesFilterStatus()" (change)="salesFilterStatus.set($any($event.target).value)">
                    <option value="">Todos</option>
                    @for(status of uniqueSalesFilterOptions().statuses; track status) {
                        <option [value]="status">{{ status }}</option>
                    }
                </select>
            </div>
             <div class="flex-grow">
                <label class="text-xs text-gray-400">Pagamento</label>
                <select class="w-full bg-gray-700 p-2 rounded text-sm" [value]="salesFilterPaymentMethod()" (change)="salesFilterPaymentMethod.set($any($event.target).value)">
                    <option value="">Todos</option>
                    @for(payment of uniqueSalesFilterOptions().payments; track payment) {
                        <option [value]="payment">{{ paymentMethodNames[payment] || payment }}</option>
                    }
                </select>
            </div>
          </div>

           <div class="bg-gray-900 p-4 rounded-lg">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-400 uppercase bg-gray-700">
                            <tr>
                                <th class="p-3">Data</th><th class="p-3">Cliente</th><th class="p-3">Tipo</th>
                                <th class="p-3">Status</th><th class="p-3">Pagamento</th><th class="p-3 text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for(order of filteredSalesOrders(); track order.id) {
                                <tr class="border-b border-gray-700">
                                    <td class="p-3">{{ order.date | date:'dd/MM HH:mm' }}</td>
                                    <td class="p-3">{{ order.customer_name }}</td>
                                    <td class="p-3">{{ paymentMethodNames[order.delivery_option] || order.delivery_option }}</td>
                                    <td class="p-3"><span class="px-2 py-1 rounded-full text-xs" [class.bg-green-500]="order.status === 'Entregue' || order.status === 'Pago e Entregue'" [class.bg-red-500]="order.status === 'Cancelado'" [class.bg-blue-500]="order.status !== 'Entregue' && order.status !== 'Pago e Entregue' && order.status !== 'Cancelado'">{{ order.status }}</span></td>
                                    <td class="p-3">{{ paymentMethodNames[order.payment_method] || order.payment_method }}</td>
                                    <td class="p-3 text-right font-semibold">{{ order.total | currency:'BRL' }}</td>
                                </tr>
                            }
                        </tbody>
                         <tfoot>
                            <tr class="font-semibold text-white">
                                <td colspan="5" class="p-3 text-right text-lg">TOTAL FILTRADO:</td>
                                <td class="p-3 text-right text-lg">{{ filteredTotalSales() | currency:'BRL' }}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
           </div>
        </div>

        <!-- Tab: Financeiro -->
        <div [class.hidden]="activeTab() !== 'accounts'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Contas a Receber -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-4">Contas a Receber (Fiado)</h2>
                <div class="space-y-2">
                    @for (item of sortedReceivables(); track item.id) {
                      <div class="p-3 rounded-md" [class.bg-gray-800]="item.status === 'pending'" [class.bg-green-800/50]="item.status === 'paid'">
                         <div class="flex justify-between">
                            <div>
                                <p class="font-bold">{{item.customer_name}}</p>
                                <p class="text-xs text-gray-400">Venc: {{item.payment_due_date | date:'dd/MM/yy'}}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-lg" [class.text-yellow-400]="item.status === 'pending'" [class.text-green-400]="item.status === 'paid'">{{item.amount | currency:'BRL'}}</p>
                                @if (item.status === 'pending') {
                                    <button (click)="markReceivableAsPaid(item.id)" class="text-xs bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded">Marcar como Pago</button>
                                }
                            </div>
                         </div>
                      </div>
                    }
                    @if(sortedReceivables().length === 0) { <p class="text-center text-gray-500 py-4">Nenhuma conta a receber.</p> }
                </div>
            </div>
            <!-- Despesas -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-4">Despesas</h2>
                <form [formGroup]="expenseForm" (ngSubmit)="saveExpense()" class="flex gap-2 mb-4">
                    <input formControlName="description" placeholder="Descri√ß√£o" class="flex-grow p-2 bg-gray-700 rounded">
                    <input type="number" formControlName="amount" placeholder="Valor" class="w-24 p-2 bg-gray-700 rounded">
                    <input type="date" formControlName="date" class="p-2 bg-gray-700 rounded">
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold px-4 rounded">{{ editingExpense() ? 'Salvar' : 'Adicionar' }}</button>
                    @if(editingExpense()) { <button type="button" (click)="cancelEditExpense()" class="bg-gray-600 hover:bg-gray-500 text-white font-bold px-4 rounded">Cancelar</button> }
                </form>
                 <div class="space-y-2">
                    @for (item of sortedExpenses(); track item.id) {
                      <div class="p-2 rounded-md bg-gray-800 flex justify-between items-center">
                         <div>
                            <p class="font-semibold">{{item.description}}</p>
                            <p class="text-xs text-gray-400">{{item.date | date:'dd/MM/yy'}}</p>
                         </div>
                         <div class="flex items-center gap-4">
                            <p class="font-bold text-red-400">{{item.amount | currency:'BRL'}}</p>
                            <div class="space-x-2">
                                <button (click)="editExpense(item)" class="text-xs text-yellow-400">Editar</button>
                                <button (click)="deleteExpense(item.id)" class="text-xs text-red-400">Excluir</button>
                            </div>
                         </div>
                      </div>
                    }
                 </div>
            </div>
        </div>
        
        <!-- Tab: Produtos -->
        <div [class.hidden]="activeTab() !== 'products'" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Categorias -->
          <div class="bg-gray-900 p-4 rounded-lg">
            <h2 class="text-xl font-bold mb-4">Categorias</h2>
            <div class="space-y-2 mb-4">
              @for (category of sortedCategories(); track category.id; let i = $index) {
                <div class="bg-gray-800 p-2 rounded-md flex items-center justify-between">
                   <div class="flex items-center gap-2">
                      <div class="flex flex-col gap-1">
                          <button (click)="moveItem('categories', i, 'up')" [disabled]="i === 0" class="disabled:opacity-25">‚ñ≤</button>
                          <button (click)="moveItem('categories', i, 'down')" [disabled]="i === sortedCategories().length - 1" class="disabled:opacity-25">‚ñº</button>
                      </div>
                      <span>{{ category.name }}</span>
                   </div>
                  <div class="space-x-2">
                    <button (click)="editCategory(category)" class="text-xs text-yellow-400">Editar</button>
                    <button (click)="deleteCategory(category.id)" class="text-xs text-red-400">Excluir</button>
                  </div>
                </div>
              }
            </div>
            <button (click)="editCategory(null)" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 rounded-lg">Nova Categoria</button>
             @if (editingCategory()) {
              <form [formGroup]="categoryForm" (ngSubmit)="saveCategory()" class="mt-4 p-3 bg-gray-800 rounded-lg space-y-2">
                <h3 class="font-semibold">{{ editingCategory()?.id ? 'Editando' : 'Nova' }} Categoria</h3>
                <input formControlName="name" placeholder="Nome da Categoria" class="w-full bg-gray-700 p-2 rounded">
                <div class="flex justify-end space-x-2">
                  <button type="button" (click)="editingCategory.set(null)" class="bg-gray-600 px-3 py-1 rounded text-sm">Cancelar</button>
                  <button type="submit" class="bg-green-600 px-3 py-1 rounded text-sm">Salvar</button>
                </div>
              </form>
            }
          </div>
          <!-- Grupos de Adicionais -->
           <div class="bg-gray-900 p-4 rounded-lg">
            <h2 class="text-xl font-bold mb-4">Grupos de Adicionais</h2>
             <div class="space-y-2 mb-4">
                @for (ac of sortedAddonCategories(); track ac.id; let i = $index) {
                <div class="bg-gray-800 p-2 rounded-md">
                   <div class="flex items-center justify-between">
                     <div class="flex items-center gap-2">
                        <div class="flex flex-col gap-1">
                            <button (click)="moveItem('addonCategories', i, 'up')" [disabled]="i === 0" class="disabled:opacity-25">‚ñ≤</button>
                            <button (click)="moveItem('addonCategories', i, 'down')" [disabled]="i === sortedAddonCategories().length - 1" class="disabled:opacity-25">‚ñº</button>
                        </div>
                        <span>{{ ac.name }}</span>
                     </div>
                    <div class="space-x-2">
                      <button (click)="editAddonCategory(ac)" class="text-xs text-yellow-400">Editar</button>
                      <button (click)="deleteAddonCategory(ac.id)" class="text-xs text-red-400">Excluir</button>
                    </div>
                  </div>
                  <p class="text-xs text-gray-400 pl-6">{{ ac.addons.length }} adicionais</p>
                </div>
              }
             </div>
            <button (click)="editAddonCategory(null)" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 rounded-lg">Novo Grupo</button>
            @if(editingAddonCategory()) {
               <form [formGroup]="addonCategoryForm" (ngSubmit)="saveAddonCategory()" class="mt-4 p-3 bg-gray-800 rounded-lg space-y-3">
                  <h3 class="font-semibold">{{ editingAddonCategory()?.id ? 'Editando' : 'Novo' }} Grupo</h3>
                  <div class="flex justify-between items-center">
                    <input formControlName="name" placeholder="Nome do Grupo" class="w-full bg-gray-700 p-2 rounded">
                    <label class="flex items-center ml-4 text-sm whitespace-nowrap"><input type="checkbox" formControlName="required" class="mr-2">Obrigat√≥rio</label>
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-gray-400">Sele√ß√£o M√≠nima</label>
                        <input type="number" formControlName="min_selection" placeholder="0" class="w-full bg-gray-700 p-2 rounded text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">Sele√ß√£o M√°xima (0 = sem limite)</label>
                        <input type="number" formControlName="max_selection" placeholder="0" class="w-full bg-gray-700 p-2 rounded text-sm">
                    </div>
                  </div>
                  <h4 class="text-sm font-semibold pt-2 border-t border-gray-700">Adicionais:</h4>
                  <div formArrayName="addons" class="space-y-2">
                    @for(addon of addonCategoryAddons.controls; track $index) {
                      <div [formGroupName]="$index" class="flex items-center gap-2">
                        <input formControlName="name" placeholder="Nome" class="flex-grow bg-gray-700 p-1 rounded text-sm">
                        <input type="number" formControlName="price" placeholder="Pre√ßo" class="w-20 bg-gray-700 p-1 rounded text-sm">
                        <label class="flex items-center text-sm"><input type="checkbox" formControlName="is_available" class="mr-1">Disp.</label>
                        <button type="button" (click)="removeAddonFromAddonCategory($index)" class="text-red-400">x</button>
                      </div>
                    }
                  </div>
                  <button type="button" (click)="addAddonToAddonCategory()" class="text-xs text-purple-400">+ Adicionar Op√ß√£o</button>
                   <div class="flex justify-end space-x-2">
                    <button type="button" (click)="editingAddonCategory.set(null)" class="bg-gray-600 px-3 py-1 rounded text-sm">Cancelar</button>
                    <button type="submit" class="bg-green-600 px-3 py-1 rounded text-sm">Salvar Grupo</button>
                  </div>
               </form>
            }
          </div>
          <!-- Produtos -->
          <div class="bg-gray-900 p-4 rounded-lg lg:col-span-3">
             <h2 class="text-xl font-bold mb-4">Produtos</h2>
             <div class="space-y-2 mb-4">
                @for (product of sortedProducts(); track product.id; let i = $index) {
                    <div class="bg-gray-800 p-2 rounded-md flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="flex flex-col gap-1">
                                <button (click)="moveItem('products', i, 'up')" [disabled]="i === 0" class="disabled:opacity-25">‚ñ≤</button>
                                <button (click)="moveItem('products', i, 'down')" [disabled]="i === sortedProducts().length - 1" class="disabled:opacity-25">‚ñº</button>
                            </div>
                            <img [src]="product.image_url || 'https://picsum.photos/50/50'" class="w-10 h-10 rounded-md object-cover">
                            <div>
                                <p class="font-semibold">{{ product.name }}</p>
                                <p class="text-xs text-gray-400">{{ getCategoryName(product.category_id) }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                           <span class="text-sm px-2 py-1 rounded-full" [class.bg-green-500]="product.is_available" [class.bg-red-500]="!product.is_available">{{ product.is_available ? 'Dispon√≠vel' : 'Indispon√≠vel' }}</span>
                           <div class="space-x-2">
                            <button (click)="editProduct(product)" class="text-xs text-yellow-400">Editar</button>
                            <button (click)="deleteProduct(product.id)" class="text-xs text-red-400">Excluir</button>
                          </div>
                        </div>
                    </div>
                }
             </div>
             <button (click)="editProduct(null)" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 rounded-lg">Novo Produto</button>
          </div>
        </div>

        <!-- Tab: Cupons -->
        <div [class.hidden]="activeTab() !== 'coupons'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-4">Cupons de Desconto</h2>
                <div class="space-y-2 mb-4">
                  @for(coupon of sortedCoupons(); track coupon.id) {
                    <div class="bg-gray-800 p-3 rounded-lg">
                      <div class="flex justify-between items-start">
                        <div>
                          <p class="font-bold text-purple-400 text-lg">{{ coupon.code }}</p>
                          <p class="text-sm">{{coupon.description}}</p>
                          <p class="text-xs text-gray-400">Pedido M√≠nimo: {{coupon.minimum_order_value | currency:'BRL'}}</p>
                        </div>
                        <div class="space-x-2">
                          <button (click)="editCoupon(coupon)" class="text-xs text-yellow-400">Editar</button>
                          <button (click)="deleteCoupon(coupon.id)" class="text-xs text-red-400">Excluir</button>
                        </div>
                      </div>
                    </div>
                  }
                </div>
                <button (click)="editCoupon(null)" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 rounded-lg">Novo Cupom</button>
            </div>
             @if(editingCoupon()) {
                <div class="bg-gray-900 p-4 rounded-lg">
                    <h2 class="text-xl font-bold mb-4">{{ editingCoupon()?.id ? 'Editar' : 'Novo' }} Cupom</h2>
                    <form [formGroup]="couponForm" (ngSubmit)="saveCoupon()" class="space-y-3">
                        <input formControlName="code" placeholder="C√≥digo do Cupom (ex: ACAI10)" class="w-full bg-gray-700 p-2 rounded uppercase">
                        <input formControlName="description" placeholder="Descri√ß√£o (ex: 10% OFF em todo o site)" class="w-full bg-gray-700 p-2 rounded">
                        <div class="grid grid-cols-2 gap-3">
                            <select formControlName="discount_type" class="w-full bg-gray-700 p-2 rounded">
                                <option value="fixed">Valor Fixo (R$)</option>
                                <option value="percentage">Porcentagem (%)</option>
                                <option value="free_shipping">Frete Gr√°tis</option>
                            </select>
                            <input formControlName="discount_value" type="number" placeholder="Valor do Desconto" class="w-full bg-gray-700 p-2 rounded">
                        </div>
                        <input formControlName="minimum_order_value" type="number" placeholder="Valor M√≠nimo do Pedido (opcional)" class="w-full bg-gray-700 p-2 rounded">
                        <div class="flex justify-end space-x-2">
                           <button type="button" (click)="editingCoupon.set(null)" class="bg-gray-600 px-4 py-2 rounded">Cancelar</button>
                           <button type="submit" class="bg-green-600 px-4 py-2 rounded">Salvar</button>
                        </div>
                    </form>
                </div>
             }
        </div>

        <!-- Tab: Roleta da Sorte -->
        <div [class.hidden]="activeTab() !== 'roleta'">
          <h2 class="text-2xl font-bold mb-4">Configura√ß√µes da Roleta da Sorte</h2>
          <form [formGroup]="wheelForm" (ngSubmit)="saveWheelSettings()" class="bg-gray-900 p-6 rounded-lg space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
              <label class="flex items-center space-x-3 cursor-pointer">
                <input type="checkbox" formControlName="enabled" class="form-checkbox h-5 w-5 rounded text-purple-500 bg-gray-700 border-gray-600 focus:ring-purple-600">
                <span class="text-lg font-medium">Ativar Roleta da Sorte</span>
              </label>
              <div>
                <label class="block text-sm font-medium mb-1">Valor M√≠nimo do Pedido para Girar</label>
                <input type="number" formControlName="minimum_order_value" class="w-full bg-gray-700 p-2 rounded">
              </div>
            </div>
            
            <div>
              <h3 class="font-semibold mb-2 text-lg">Pr√™mios da Roleta (8 no total)</h3>
              <div formArrayName="prizes" class="space-y-4">
                @for(prizeControl of wheelPrizes.controls; track $index) {
                  <div [formGroupName]="$index" class="p-3 bg-gray-800 rounded-lg space-y-3">
                    <p class="font-bold text-purple-400">Pr√™mio {{$index + 1}}</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <div>
                        <label class="text-xs text-gray-400">Texto na Roleta</label>
                        <input formControlName="label" placeholder="Ex: 10% OFF" class="w-full bg-gray-700 p-2 rounded text-sm">
                      </div>
                      <div>
                        <label class="text-xs text-gray-400">Tipo de Pr√™mio</label>
                        <select formControlName="type" class="w-full bg-gray-700 p-2 rounded text-sm">
                          <option value="none">Sem Pr√™mio (Tente de Novo)</option>
                          <option value="fixed">Valor Fixo (R$)</option>
                          <option value="percentage">Porcentagem (%)</option>
                          <option value="free_shipping">Frete Gr√°tis</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-400">Valor do Pr√™mio</label>
                        <input formControlName="value" type="number" placeholder="0" class="w-full bg-gray-700 p-2 rounded text-sm">
                      </div>
                       <div>
                        <label class="text-xs text-gray-400">C√≥digo do Cupom (gerado)</label>
                        <input formControlName="couponCode" placeholder="Ex: SORTE10" class="w-full bg-gray-700 p-2 rounded text-sm">
                      </div>
                       <div class="sm:col-span-2">
                        <label class="text-xs text-gray-400">Descri√ß√£o do Pr√™mio</label>
                        <input formControlName="description" placeholder="Ex: Pr√™mio da Roleta: 10% OFF" class="w-full bg-gray-700 p-2 rounded text-sm">
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>

            <div class="pt-4 border-t border-gray-700">
              <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg">
                Salvar Configura√ß√µes da Roleta
              </button>
            </div>
          </form>
        </div>

        <!-- Tab: Entregadores -->
        <div [class.hidden]="activeTab() !== 'drivers'" class="bg-gray-900 p-4 rounded-lg">
            <div class="flex items-center space-x-4 mb-4 border-b border-gray-700">
                <button (click)="driverView.set('management')" class="py-2 px-1 font-medium" [class.border-b-2]="driverView() === 'management'" [class.border-purple-500]="driverView() === 'management'" [class.text-purple-400]="driverView() === 'management'">Gerenciamento</button>
                <button (click)="driverView.set('reports')" class="py-2 px-1 font-medium" [class.border-b-2]="driverView() === 'reports'" [class.border-purple-500]="driverView() === 'reports'" [class.text-purple-400]="driverView() === 'reports'">Relat√≥rios e Pagamentos</button>
            </div>

            @if(driverView() === 'management') {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Pendentes -->
                <div>
                  <h3 class="font-bold text-yellow-400 mb-2">Pendentes de Aprova√ß√£o</h3>
                  <div class="space-y-2">
                    @for(driver of pendingDrivers(); track driver.id) {
                      <div class="bg-gray-800 p-3 rounded">
                        <p class="font-semibold">{{driver.name}}</p>
                        <p class="text-xs text-gray-400">{{driver.whatsapp}}</p>
                        <div class="mt-2 space-x-2">
                          <button (click)="openConfirmModal('approve', driver.id, 'Aprovar o cadastro de ' + driver.name + '?')" class="text-xs bg-green-600 px-2 py-1 rounded">Aprovar</button>
                          <button (click)="openConfirmModal('decline', driver.id, 'Recusar o cadastro de ' + driver.name + '?')" class="text-xs bg-red-600 px-2 py-1 rounded">Recusar</button>
                        </div>
                      </div>
                    }
                  </div>
                </div>
                 <!-- Aprovados -->
                <div>
                  <h3 class="font-bold text-green-400 mb-2">Aprovados</h3>
                   <div class="space-y-2">
                    @for(driver of approvedDrivers(); track driver.id) {
                      <div class="bg-gray-800 p-3 rounded">
                        <p class="font-semibold">{{driver.name}}</p>
                        <p class="text-xs text-gray-400">{{driver.whatsapp}}</p>
                        <div class="mt-2 space-x-2">
                          <button (click)="openConfirmModal('block', driver.id, 'Bloquear o acesso de ' + driver.name + '?')" class="text-xs bg-yellow-600 px-2 py-1 rounded">Bloquear</button>
                          <button (click)="openConfirmModal('ban', driver.id, 'BANIR PERMANENTEMENTE ' + driver.name + '? Esta a√ß√£o n√£o pode ser desfeita.')" class="text-xs bg-red-600 px-2 py-1 rounded">Banir</button>
                        </div>
                      </div>
                    }
                  </div>
                </div>
                 <!-- Bloqueados -->
                <div>
                  <h3 class="font-bold text-orange-400 mb-2">Bloqueados</h3>
                   <div class="space-y-2">
                    @for(driver of blockedDrivers(); track driver.id) {
                      <div class="bg-gray-800 p-3 rounded">
                        <p class="font-semibold">{{driver.name}}</p>
                        <p class="text-xs text-gray-400">{{driver.whatsapp}}</p>
                        <div class="mt-2 space-x-2">
                          <button (click)="unblockDriver(driver.id)" class="text-xs bg-green-600 px-2 py-1 rounded">Desbloquear</button>
                        </div>
                      </div>
                    }
                  </div>
                </div>
                 <!-- Recusados -->
                <div>
                  <h3 class="font-bold text-red-400 mb-2">Recusados</h3>
                   <div class="space-y-2">
                    @for(driver of declinedDrivers(); track driver.id) {
                      <div class="bg-gray-800 p-3 rounded">
                        <p class="font-semibold">{{driver.name}}</p>
                        <p class="text-xs text-gray-400">{{driver.whatsapp}}</p>
                      </div>
                    }
                  </div>
                </div>
              </div>
            } @else {
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Driver Selection & Payment -->
                <div class="lg:col-span-1">
                  <h3 class="font-bold mb-2">Selecione o Entregador</h3>
                   <select (change)="selectDriverForReport($event)" class="w-full p-2 bg-gray-700 rounded mb-4">
                      <option value="">Selecione...</option>
                      @for(driver of approvedDrivers(); track driver.id) {
                        <option [value]="driver.id">{{ driver.name }}</option>
                      }
                   </select>

                   @if(selectedDriverForReport(); as driver) {
                    <div class="bg-gray-800 p-4 rounded-lg">
                       <h3 class="text-lg font-bold mb-2">Registrar Pagamento para {{driver.name}}</h3>
                       <div class="text-center my-4 p-3 rounded-lg bg-gray-700">
                          <p class="text-sm text-gray-400">Saldo a Pagar</p>
                          <p class="text-2xl font-bold" [class.text-red-400]="reportTotals().balance > 0" [class.text-green-400]="reportTotals().balance <= 0">{{ reportTotals().balance | currency:'BRL' }}</p>
                       </div>
                       <form [formGroup]="driverPaymentForm" (ngSubmit)="saveDriverPayment()" class="space-y-3">
                          <input formControlName="amount" type="number" placeholder="Valor Pago" class="w-full p-2 bg-gray-700 rounded">
                          <input formControlName="payment_date" type="date" class="w-full p-2 bg-gray-700 rounded">
                          <textarea formControlName="notes" placeholder="Notas (opcional)" class="w-full p-2 bg-gray-700 rounded h-16"></textarea>
                          <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded">Registrar Pagamento</button>
                       </form>
                    </div>
                   }
                </div>
                <!-- Reports -->
                <div class="lg:col-span-2">
                   @if(selectedDriverForReport(); as driver) {
                      <div class="grid grid-cols-2 gap-4">
                        <!-- Deliveries -->
                        <div>
                           <h3 class="font-bold mb-2">Entregas ({{reportDeliveries().length}}) - Total: {{ reportTotals().totalFees | currency:'BRL' }}</h3>
                           <div class="space-y-2 max-h-96 overflow-y-auto">
                              @for(delivery of reportDeliveries(); track delivery.id) {
                                <div class="bg-gray-800 p-2 rounded text-sm flex justify-between">
                                  <span>#{{delivery.id.slice(-4)}} - {{delivery.date | date:'dd/MM'}}